---
- name: remove mariadb
  become: yes
  yum:
    name: mariadb* 
    state: absent

- name: remove mysql-server
  become: yes
  yum:
    name: mysql-server
    state: absent

- name: import GPG-Key
  become: yes
  rpm_key:
    state: present
    key: https://repo.mysql.com/RPM-GPG-KEY-mysql-2022

- name: download mysql rpm
  become: yes
  get_url:
    url: https://dev.mysql.com/get/mysql80-community-release-el7-11.noarch.rpm

- name: install mysql rpm
  become: yes
  yum:
    name: /home/ec2-user/mysql80-community-release-el7-11.noarch.rpm
    state: present

- name: install mysql-community-devel and server
  become: yes
  yum:
    name:
      - mysql-community-devel
      - mysql-community-server
    state: present

- name: create database.yml
  become_user: root
  template:
    src: database.yml.j2
    dest: "{{ app_dir }}/config/database.yml"

